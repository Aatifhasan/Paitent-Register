## Table of Contents
- [Installation](#installation)
- [Usage](#usage)
- [API Endpoints](#api-endpoints)
  - [Register New Patient](#register-new-patient)
  - [Get Psychiatrists by Hospital](#get-psychiatrists-by-hospital)
- [File Upload Configuration](#file-upload-configuration)
- [Error Handling](#error-handling)
- [Models](#models)

## Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd <repository-directory>
   ```

2. Install the dependencies:
   ```bash
   npm install
   ```

3. Ensure you have a running instance of a compatible database (e.g., PostgreSQL, MySQL).

4. Set up environment variables (e.g., database connection details).

## Usage

Start the Express server:
```bash
node app.js
```

## API Endpoints

### Register New Patient

**Endpoint:** `POST /register`

This endpoint registers a new patient with optional photo upload.

**Request Body:**
- `name`: (string) Patient's name
- `address`: (string) Patient's address
- `email`: (string) Patient's email
- `phone`: (string) Patient's phone number
- `password`: (string) Patient's password
- `photo`: (file) Patient's photo

**Response:**
- `201 Created`: If the patient is registered successfully.
- `500 Internal Server Error`: If there is an error during registration.

**Example Request:**
```curl
curl -X POST http://localhost:3000/register \\
  -F "name=John Doe" \\
  -F "address=123 Main St" \\
  -F "email=johndoe@example.com" \\
  -F "phone=1234567890" \\
  -F "password=securepassword" \\
  -F "photo=@path/to/photo.jpg"
```

### Get Psychiatrists by Hospital

**Endpoint:** `GET /psychiatrists/:hospitalId`

This endpoint retrieves the list of psychiatrists and their patients for a specified hospital.

**Parameters:**
- `hospitalId`: (string) ID of the hospital

**Response:**
- `200 OK`: If the data is retrieved successfully.
- `404 Not Found`: If the hospital is not found.
- `500 Internal Server Error`: If there is an error during retrieval.

**Example Response:**
```json
{
      "hospitalName": "City Hospital",
  "totalPsychiatristsCount": 3,
  "totalPatientsCount": 30,
  "psychiatrists": [
        {
          "id": 1,
      "name": "Dr. Smith",
      "patientsCount": 10
    },
    {
          "id": 2,
      "name": "Dr. Johnson",
      "patientsCount": 15
    },
    {
          "id": 3,
      "name": "Dr. Lee",
      "patientsCount": 5
    }
  ]
}
```

## File Upload Configuration

File uploads are handled using `multer`. Uploaded files are stored in the `./uploads` directory with a unique filename generated by prepending the current timestamp to the original filename.

### Multer Configuration:
```javascript
const storage = multer.diskStorage({
        destination: function (req, file, cb) {
            cb(null, './uploads');
    },
    filename: function (req, file, cb) {
            cb(null, Date.now() + '-' + file.originalname);
    }
});
const upload = multer({ storage: storage });
```

## Error Handling

The API includes basic error handling to return appropriate HTTP status codes and error messages:
- `500 Internal Server Error`: For general server errors.
- `404 Not Found`: When a requested resource (e.g., hospital) is not found.

## Models

The code uses Sequelize models to interact with the database. The primary models are:
- `Patient`: Represents patient data.
- `Psychiatrist`: Represents psychiatrist data.
- `Hospital`: Represents hospital data.

Ensure your database is properly configured with these models for the API to function correctly.
